<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Privacy-First Analytics</title>

  <!-- countries-and-timezones (~9 KB) -->
  <script
    src="https://cdn.jsdelivr.net/gh/manuelmhtr/countries-and-timezones@latest/dist/index.min.js"
    type="text/javascript"
    crossorigin="anonymous"></script>
</head>
<body>
  <script>
    // 1) Part-of-day bucket
    function getPartOfDay() {
      const h = new Date().getHours();
      if (h < 6)   return 'night';
      if (h < 12)  return 'morning';
      if (h < 18)  return 'afternoon';
      return 'evening';
    }

    // 2) Device type via UA string
    function getDeviceType(ua) {
      if (/Mobi|Android|iPhone|iPod/.test(ua)) return 'Mobile';
      if (/iPad|Tablet/.test(ua))              return 'Tablet';
      return 'Desktop';
    }

    // 3) Derive ‚Äúpath‚Äù key from hostname + pathname
    function getPathKey() {
      // subdomain?
      const host = window.location.hostname.split('.');
      const hasSub = host.length > 2;
      const sub   = hasSub ? host.slice(0, host.length - 2).join('.') : '';
      // path segments
      let p = window.location.pathname.split('/').filter(Boolean).join('/');
      if (!p) p = 'home';
      return sub ? `${sub}/${p}` : p;
    }

    // 4) Fire off analytics
    document.addEventListener('DOMContentLoaded', () => {
      // timezone ‚Üí country
      const tz     = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
      const tzInfo = (typeof ct !== 'undefined' && ct.getTimezone)
        ? ct.getTimezone(tz)
        : null;
      const country = (tzInfo && tzInfo.countries.length)
        ? tzInfo.countries[0]
        : 'XX';

      // browser language
      const language = navigator.language || navigator.userLanguage || 'und';

      // device & partOfDay
      const device    = getDeviceType(navigator.userAgent);
      const partOfDay = getPartOfDay();

      // our ‚Äúraw‚Äù payload
      const payload = {
        path:      getPathKey(),           // e.g. "foo" or "bar/foo"
        country,                          // e.g. "GR"
        language,                         // e.g. "en-GB"
        deviceType: device,               // "Mobile"|"Tablet"|"Desktop"
        partOfDay,                        // "night"|"morning"|"afternoon"|"evening"
        ts: { '.sv': 'timestamp' }        // server‚Äêgenerated timestamp
      };

      // üöÄ send to RTDB via REST
      fetch('https://marko-be9a9-default-rtdb.firebaseio.com/raw.json', {
        method:  'POST',
        headers: { 'Content-Type': 'application/json' },
        body:    JSON.stringify(payload)
      }).catch(console.error);
    });
  </script>
</body>
</html>

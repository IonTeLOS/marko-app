<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create your Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/ui/trumbowyg.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/colors/ui/trumbowyg.colors.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/fontsize/ui/trumbowyg.fontsize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/fontfamily/ui/trumbowyg.fontfamily.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/highlight/ui/trumbowyg.highlight.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/lineheight/ui/trumbowyg.lineheight.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/indent/ui/trumbowyg.indent.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/resizing/ui/trumbowyg.resizing.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/trumbowyg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/base64/trumbowyg.base64.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/noembed/trumbowyg.noembed.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/history/trumbowyg.history.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/colors/trumbowyg.colors.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/fontsize/trumbowyg.fontsize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/fontfamily/trumbowyg.fontfamily.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/giphy/trumbowyg.giphy.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/indent/trumbowyg.indent.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/lineheight/trumbowyg.lineheight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/pasteimage/trumbowyg.pasteimage.min.js"></script>
    <script src="https://rawcdn.githack.com/RickStrahl/jquery-resizable/0.35/dist/jquery-resizable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/resizimg/trumbowyg.resizimg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/pasteembed/trumbowyg.pasteembed.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/insertaudio/trumbowyg.insertaudio.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/emoji/ui/trumbowyg.emoji.min.css">
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/emoji/trumbowyg.emoji.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
               .material-btn {
            display: inline-flex;
            align-items: center;
            width: 100%;
            background-color: #6200ea;
            color: white;
            border: none;
            padding: 12px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            border-radius: 4px;
            justify-content: center;
        }
        .material-btn:hover {
            background-color: #3700b3;
        }
        .material-icons {
            margin-right: 8px;
        }
        .custom-button {
            background-color: #6200ea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>Create your Page</h1>
<div id="editor" style="height: 300px;"></div>
<button id="viewHtml" class="material-btn">
    <span class="material-icons">preview</span> Preview
</button>
<div id="viewer" style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;"></div>

<!-- Material-style download button -->
<button id="downloadHtml" class="material-btn">
    <span class="material-icons">download</span> Download
</button>


<script>
$(document).ready(function() {

    let selectedBgColor = '#ffffff'; // Default background color

    // Custom plugin for changing background color
    $.trumbowyg.plugins.changeBgColor = {
        init: function(trumbowyg) {
            trumbowyg.o.plugins.changeBgColor = {};
            
            // Add a button to the toolbar
            trumbowyg.addBtnDef('changeBgColor', {
                fn: function() {
                    let color = prompt('Enter a background color (name, hex, rgb, etc.):', selectedBgColor);
                    if (color) {
                        selectedBgColor = color;
                        // Change the background color in the editor
                        $('#editor').css('background-color', selectedBgColor);
                    }
                },
                tag: 'button',
                text: 'BG Color',
                title: 'Change Background Color',
                hasIcon: false
            });
        }
    };
    // Custom plugin to convert a link to a Material-styled button
    $.trumbowyg.plugins.convertLinkToButton = {
        init: function(trumbowyg) {
            trumbowyg.o.plugins.convertLinkToButton = {};
            
            // Add a custom button to the toolbar
            trumbowyg.addBtnDef('convertLinkToButton', {
                fn: function() {
                    let selectedLink = getSelectedLink();
                    if (selectedLink) {
                        let href = selectedLink.attr('href'); // Get the href of the selected link
                        let buttonText = selectedLink.text(); // Get the text of the selected link
                        let newButtonHtml = `<a href="${href}" target="_blank">
                                                <button class="custom-button">${buttonText}</button>
                                             </a>`;
                        selectedLink.replaceWith(newButtonHtml); // Replace the link with the button inside an <a> tag
                    } else {
                        alert('No link selected!');
                    }
                },
                tag: 'button',
                text: 'Convert to Button',
                title: 'Convert Selected Link to Button',
                hasIcon: false
            });
        }
    };
    
    $('#editor').trumbowyg({
        btns: [
            ['viewHTML'],
            ['undo', 'redo'],
            ['formatting'],
            ['fontfamily'], 
            ['fontsize'], 
            ['foreColor', 'backColor'],
            ['highlight'], 
            ['strong', 'em'],
            ['superscript'],
            ['lineheight'],
            ['unorderedList', 'orderedList'],
            ['indent'],
            ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
            ['link', 'insertImage', 'base64', 'noembed', 'insertAudio'],
            ['giphy', 'emoji'],
                        ['convertLinkToButton'], // Add the link-to-button converter

            ['horizontalRule', ],
                        ['changeBgColor'], // Add the background color change button here

            ['removeformat'],
            ['fullscreen'],
            ['pasteembed']
        ],
        plugins: {
            base64: {},
            noembed: {},
            history: {},
            pasteembed: {},
            insertaudio: {},
            resizimg: {
                minSize: 64, 
                step: 16     
            },
            colors: {
            colorList: [
                '000000', 'FFFFFF', 'A9A9A9', '0000FF', 'FF0000', '008000', '00FFFF', 'FF00FF', 'D3D3D3', 'ADD8E6', 'FFFFE0', '90EE90', 'F08080', 'F5F5DC', 'E6E6FA', 'C0C0C0', '808080', '800000', 'FFFF00', '008080', '000080'
            ]
        },
            emoji: {},
            fontsize: {},
            fontfamily: {
            fontlist: ['Roboto']},
            giphy: {},
            indent: {},
            lineheight: {},
            pasteimage: {}
        },
        autogrow: true,
        semantic: true,
        lang: 'en'
    });

    // Button to preview the HTML content of the editor
    $('#viewHtml').click(function() {
        var htmlContent = $('#editor').trumbowyg('html');
        var styledHtmlContent = `
        <html>
            <head>
                <title>Your Page</title>
                <style> body { background-color: ${selectedBgColor}; } </style>
            </head>
            <body>
                ${htmlContent}
            </body>
        </html>`;
        $('#viewer').html(styledHtmlContent);
    });

    // Button to download the HTML content
    $('#downloadHtml').click(function() {
        var htmlContent = $('#editor').trumbowyg('html');
        var styledHtmlContent = `
        <html>
            <head>
                <title>Your Page</title>
                <style> body { background-color: ${selectedBgColor}; } </style>
            </head>
            <body>
                ${htmlContent}
            </body>
        </html>`;

        // Create a downloadable HTML file
        var blob = new Blob([styledHtmlContent], { type: 'text/html' });
        var link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'your_page.html';
        link.click();
    });
    // Function to get the selected link
    function getSelectedLink() {
        var selection = window.getSelection();
        if (selection.rangeCount > 0) {
            var range = selection.getRangeAt(0);
            var selectedNode = range.commonAncestorContainer;
            if (selectedNode.nodeType === 3) {
                selectedNode = selectedNode.parentNode;
            }
            if (selectedNode.tagName === 'A') {
                return $(selectedNode);
            }
        }
        return null;
    }
});    
</script>

</body>
</html>

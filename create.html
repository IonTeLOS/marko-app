<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create your Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/ui/trumbowyg.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/colors/ui/trumbowyg.colors.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/fontsize/ui/trumbowyg.fontsize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/fontfamily/ui/trumbowyg.fontfamily.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/highlight/ui/trumbowyg.highlight.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/indent/ui/trumbowyg.indent.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/resizing/ui/trumbowyg.resizing.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/trumbowyg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/base64/trumbowyg.base64.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/noembed/trumbowyg.noembed.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/history/trumbowyg.history.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/colors/trumbowyg.colors.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/fontsize/trumbowyg.fontsize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/fontfamily/trumbowyg.fontfamily.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/indent/trumbowyg.indent.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/pasteimage/trumbowyg.pasteimage.min.js"></script>
    <script src="https://rawcdn.githack.com/RickStrahl/jquery-resizable/0.35/dist/jquery-resizable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/resizimg/trumbowyg.resizimg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/pasteembed/trumbowyg.pasteembed.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg/dist/plugins/insertaudio/trumbowyg.insertaudio.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            flex-grow: 1;
        }
        .material-btn {
            display: inline-flex;
            align-items: center;
            width: 100%;
            max-width: 300px;
            background-color: #6200ea;
            color: white;
            border: none;
            padding: 12px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            border-radius: 4px;
            justify-content: center;
            transition: background-color 0.3s ease;
        }
        .material-btn:hover {
            background-color: #3700b3;
        }
        .material-icons {
            margin-right: 8px;
        }
        .custom-button {
            background-color: #6200ea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .custom-button:hover {
            background-color: #3700b3;
        }
        #editor {
            height: 300px;
            margin-bottom: 20px;
        }
        #viewer {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            min-height: 200px;
        }
        footer {
            background: linear-gradient(to right, #6200ea, #3700b3);
            color: white;
            padding: 20px 0;
            margin-top: 40px;
            text-align: center;
        }
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 10px;
        }
        .footer-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid white;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        .footer-link:hover {
            background-color: white;
            color: #6200ea;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .material-btn {
                font-size: 14px;
            }
            #editor {
                height: 250px;
            }
            .footer-links {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div id="editor"></div>
    <button id="viewHtml" class="material-btn">
        <span class="material-icons">preview</span> Preview
    </button>
    <div id="viewer"></div>
    <button id="downloadHtml" class="material-btn">
        <span class="material-icons">download</span> Download
    </button>
</div>

<footer>
    <h3>Explore More</h3>
    <div class="footer-links">
        <a href="https://marko-app.netlify.app" class="footer-link" target="_blank">Main App</a>
        <a href="https://grapesjs.com/demo" class="footer-link" target="_blank">Rich Editor</a>
        <a href="https://marko-app.netlify.app/driverserver" class="footer-link" target="_blank">Convert to Single Page App</a>
        <a href="https://marko-app.netlify.app/merge" class="footer-link" target="_blank">Separate CSS-JS?</a>
    </div>
</footer>

<script>
$(document).ready(function() {

    let selectedBgColor = '#ffffff'; // Default background color

    // Custom plugin for changing background color
    $.trumbowyg.plugins.changeBgColor = {
        init: function(trumbowyg) {
            trumbowyg.o.plugins.changeBgColor = {};
            
            trumbowyg.addBtnDef('changeBgColor', {
                fn: function() {
                    let color = prompt('Enter a background color (name, hex, rgb, etc.):', selectedBgColor);
                    if (color) {
                        selectedBgColor = color;
                        // Change the background color in the editor
                        $('#editor').css('background-color', selectedBgColor);
                    }
                },
                tag: 'button',
                title: 'Change Background Color',
                hasIcon: true
 
            });
        }
    };
    // Custom plugin to convert a link to a Material-styled button
    $.trumbowyg.plugins.convertLinkToButton = {
        init: function(trumbowyg) {
            trumbowyg.o.plugins.convertLinkToButton = {};
            
            trumbowyg.addBtnDef('convertLinkToButton', {
                fn: function() {
                    let selectedLink = getSelectedLink();
                    if (selectedLink) {
                        let href = selectedLink.attr('href'); 
                        let buttonText = selectedLink.text();
                        let newButtonHtml = `<a href="${href}" target="_blank">
                                                <button class="custom-button">${buttonText}</button>
                                             </a>`;
                        selectedLink.replaceWith(newButtonHtml); 
                    } else {
                        alert('No link selected!');
                    }
                },
                tag: 'button',
                text: 'Convert to Button',
                title: 'Convert Selected Link to Button',
                hasIcon: true
            });
        }
    };

    $('#editor').trumbowyg({
        btns: [
            ['viewHTML'],
            ['undo', 'redo'],
            ['formatting'],
            ['fontfamily'], 
            ['fontsize'], 
            ['foreColor', 'backColor', 'changeBgColor'],
            ['highlight'], 
            ['strong', 'em'],
            ['superscript'],
            ['unorderedList', 'orderedList'],
            ['indent'],
            ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
            ['link', 'convertLinkToButton', 'insertImage', 'base64', 'noembed', 'insertAudio'],
            ['horizontalRule', ],
            ['removeformat'],
            ['fullscreen'],
            ['pasteembed']
        ],
        plugins: {
            base64: {},
            noembed: {},
            history: {},
            pasteembed: {},
            insertaudio: {},
            resizimg: {
                minSize: 64, 
                step: 16     
            },
            colors: {
            colorList: [
                '000000', 'FFFFFF', 'A9A9A9', '0000FF', 'FF0000', '008000', '00FFFF', 'FF00FF', 'D3D3D3', 'ADD8E6', 'FFFFE0', '90EE90', 'F08080', 'F5F5DC', 'E6E6FA', 'C0C0C0', '808080', '800000', 'FFFF00', '008080', '000080'
              ]
            },
            fontsize: {},
            fontfamily: {
            fontlist: ['Roboto']},
            indent: {},
            pasteimage: {}
        },
        autogrow: true,
        semantic: true,
        lang: 'en'
    });

    // Button to preview the HTML content of the editor
    $('#viewHtml').click(function() {
        var htmlContent = $('#editor').trumbowyg('html');
        var styledHtmlContent = `
        <html>
            <head>
                <title>Your Page</title>
                <style> body { background-color: ${selectedBgColor}; }                    
        .custom-button {
            background-color: #6200ea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
        }
        </style>
            </head>
            <body>
                ${htmlContent}
            </body>
        </html>`;
        $('#viewer').html(styledHtmlContent);
    });

    // Button to download the HTML content
    $('#downloadHtml').click(function() {
        var htmlContent = $('#editor').trumbowyg('html');
        var styledHtmlContent = `
        <html>
            <head>
                <title>Your Page</title>
                <style> body { background-color: ${selectedBgColor}; } 
        .custom-button {
            background-color: #6200ea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
        }
        </style>
            </head>
            <body>
                ${htmlContent}
            </body>
        </html>`;

        // Create a downloadable HTML file
        var blob = new Blob([styledHtmlContent], { type: 'text/html' });
        var link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'your_page.html';
        link.click();
    });
    
    // Function to get the selected link
    function getSelectedLink() {
        var selection = window.getSelection();
        if (selection.rangeCount > 0) {
            var range = selection.getRangeAt(0);
            var selectedNode = range.commonAncestorContainer;
            if (selectedNode.nodeType === 3) {
                selectedNode = selectedNode.parentNode;
            }
            if (selectedNode.tagName === 'A') {
                return $(selectedNode);
            }
        }
        return null;
    }
    var changeBgColorButton = $('.trumbowyg-changeBgColor-button');
    var materialIconC = $('<span>').addClass('material-icons').text('format_color_fill');
    changeBgColorButton.empty().append(materialIconC);
    
    var convertLinkToButton = $('.trumbowyg-convertLinkToButton-button');
    var materialIconB = $('<span>').addClass('material-icons').text('transform');
    convertLinkToButton.empty().append(materialIconB);

});    
</script>
</body>
</html>

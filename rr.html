<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arweave Free Upload</title>
    <script src="https://cdn.jsdelivr.net/npm/@irys/sdk@0.2.11/dist/bundle.js"></script>
</head>
<body>
    <h2>Arweave Free Tier (< 100KB)</h2>
    <textarea id="textInput" rows="5" cols="40">Hello from the Permaweb!</textarea><br>
    <button id="uploadBtn">Upload to Arweave</button>

    <script>
        const uploadBtn = document.getElementById('uploadBtn');

        uploadBtn.addEventListener('click', async () => {
            const text = document.getElementById('textInput').value;
            if (!text) return alert("Enter text");

            try {
                uploadBtn.disabled = true;
                uploadBtn.innerText = "Initializing...";

                // 1. Create a "Web Irys" instance using the public node
                // node2 is the standard for Arweave-settled data
                const irys = new Irys.default({
                    url: "https://node2.irys.xyz", 
                    token: "arweave"
                });

                // 2. Prepare the data
                const tags = [{ name: "Content-Type", value: "text/plain" }];
                
                uploadBtn.innerText = "Signing Bundle...";

                // 3. For the Free Tier (< 100KB), Irys allows "unfunded" uploads
                // We use a "mock" wallet provided by the browser's crypto
                // This call handles the binary signing and bundling automatically
                const response = await irys.upload(text, { tags });

                console.log("Upload Success:", response);
                alert(`SUCCESS!\nArweave ID: ${response.id}`);
                window.open(`https://arweave.net/${response.id}`, '_blank');

            } catch (error) {
                console.error("Upload Error:", error);
                // Fallback explanation
                if (error.message.includes("402")) {
                    alert("File too large for free tier (>100KB).");
                } else {
                    alert("Error: " + error.message);
                }
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerText = "Upload to Arweave";
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arweave Free Text Upload</title>
</head>
<body>
    <h2>Arweave Free Text Upload (< 100KB)</h2>
    <textarea id="textInput" rows="5" cols="40" placeholder="Type text here..."></textarea><br>
    <button id="uploadBtn">Upload to Arweave</button>

    <script type="module">
        import { TurboFactory } from 'https://cdn.jsdelivr.net/npm/@ardrive/turbo-sdk@latest/bundles/web.bundle.min.js';

        const uploadBtn = document.getElementById('uploadBtn');

        uploadBtn.addEventListener('click', async () => {
            const text = document.getElementById('textInput').value;
            if (!text) return alert("Please enter text");

            try {
                uploadBtn.disabled = true;
                uploadBtn.innerText = "Bundling & Sending...";

                // 1. Initialize the unauthenticated client (for free tier)
                const turbo = TurboFactory.unauthenticated();

                // 2. Prepare the data as a Blob (browser native)
                const blob = new Blob([text], { type: 'text/plain' });

                // 3. Upload using the SDK's internal bundling logic
                // This handles the "ANS-104" format that raw fetch calls miss.
                const result = await turbo.uploadFile({
                    fileStreamFactory: () => blob.stream(),
                    fileSizeFactory: () => blob.size,
                    dataItemOpts: {
                        tags: [
                            { name: 'Content-Type', value: 'text/plain' },
                            { name: 'App-Name', value: 'Plain-JS-Tester-2026' }
                        ]
                    }
                });

                console.log("Upload Success:", result);
                alert(`SUCCESS!\nArweave ID: ${result.id}`);
                window.open(`https://arweave.net/${result.id}`, '_blank');

            } catch (error) {
                console.error("SDK Error:", error);
                alert("Error: " + error.message);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerText = "Upload to Arweave";
            }
        });
    </script>
</body>
</html>

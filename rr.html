<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arweave Free Upload</title>
</head>
<body>
    <h2>Turbo Free Tier (< 100KB)</h2>
    <textarea id="textInput" rows="5" cols="40">Hello Arweave!</textarea><br>
    <button id="uploadBtn">Upload</button>

    <script type="module">
        import { TurboFactory } from 'https://cdn.jsdelivr.net/npm/@ardrive/turbo-sdk@latest/bundles/web.bundle.min.js';

        const uploadBtn = document.getElementById('uploadBtn');

        uploadBtn.addEventListener('click', async () => {
            const text = document.getElementById('textInput').value;
            
            try {
                uploadBtn.disabled = true;
                uploadBtn.innerText = "Uploading...";

                // 1. Initialize
                const turbo = TurboFactory.unauthenticated();
                
                // 2. Prepare data
                const blob = new Blob([text], { type: 'text/plain' });

                // 3. THE ONLY METHOD THAT WORKS: postAllowedUpload
                // This specifically targets the free subsidized tier.
                const result = await turbo.postAllowedUpload({
                    fileStreamFactory: () => blob.stream(),
                    fileSizeFactory: () => blob.size,
                    signal: new AbortController().signal // Required by some versions of the SDK
                });

                console.log("Success:", result);
                alert(`SUCCESS! ID: ${result.id}`);
                window.open(`https://arweave.net/${result.id}`, '_blank');

            } catch (error) {
                console.error("SDK Error:", error);
                // If the method is STILL missing, we inspect the object live:
                const turbo = TurboFactory.unauthenticated();
                console.log("Available methods on turbo object:", Object.keys(Object.getPrototypeOf(turbo)));
                alert("Check console for available methods. The SDK bundle may have changed.");
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerText = "Upload";
            }
        });
    </script>
</body>
</html>

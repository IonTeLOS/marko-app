<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Browser Video Compressor</title>
</head>
<body>
<input type="file" id="videoInput" accept="video/*" />
<button id="compressBtn">Compress</button>
<p id="status"></p>
<a id="downloadLink" style="display:none;">Download</a>

<script type="module">
import { createFFmpeg, fetchFile } from "https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.10/dist/ffmpeg.mjs";

const ffmpeg = createFFmpeg({ log: true });
const statusEl = document.getElementById('status');
const downloadLink = document.getElementById('downloadLink');

document.getElementById('compressBtn').addEventListener('click', async () => {
  const fileInput = document.getElementById('videoInput');
  if (!fileInput.files.length) return alert("Select a video!");

  const file = fileInput.files[0];

  statusEl.textContent = "Loading FFmpeg...";
  if (!ffmpeg.isLoaded()) await ffmpeg.load();

  statusEl.textContent = "Compressing...";
  ffmpeg.FS("writeFile", "input.mp4", await fetchFile(file));

  await ffmpeg.run(
    "-i", "input.mp4",
    "-vf", "scale=720:-2",
    "-b:v", "1M",
    "-c:v", "libx264",
    "-preset", "fast",
    "-c:a", "aac",
    "-b:a", "128k",
    "output.mp4"
  );

  const data = ffmpeg.FS("readFile", "output.mp4");
  const blob = new Blob([data.buffer], { type: "video/mp4" });
  const url = URL.createObjectURL(blob);

  downloadLink.href = url;
  downloadLink.download = "compressed.mp4";
  downloadLink.style.display = "block";
  downloadLink.textContent = "Download Compressed Video";

  statusEl.textContent = "Done!";
});
</script>
</body>
</html>
